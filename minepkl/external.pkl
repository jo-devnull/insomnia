import "tags/category/@category.pkl" as categoryTags
import "lib/utils.pkl" as utils
import "misc/incontrol.pkl" as incontrol

function buildEmi() = new Mapping<String, FileOutput> {
  ["emi.json"] {
    value {
      hidden_stacks = utils.load("instance:emi.json")
        .getOrNull("hidden_stacks")

      favorites = new Listing {
        for (tag in categoryTags.toMap().keys) {
          new { stack = "#item:category:\(tag)" }
        }
      }
    }

    renderer = new JsonRenderer {}
  }
}

function buildIncontrol() = new Mapping<String, FileOutput> {
  ["config/incontrol/spawn.json"] {
    value = incontrol.rules
    renderer = new JsonRenderer {}
  }

  ["config/incontrol/phases.json"] {
    value = incontrol.phases
    renderer = new JsonRenderer {}
  }
}

output {
  files {
    ...buildEmi()
    ...buildIncontrol()
  }
}
